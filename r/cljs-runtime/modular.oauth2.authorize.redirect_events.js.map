{"version":3,"sources":["modular/oauth2/authorize/redirect_events.cljs"],"mappings":";AAYA,mEAAA,nEAAOA,8IAAyBC;AAAhC,AACE,8BAAA,mFAAA,1GAACC,kLAA8BD;;AAEjC,AAACE,oDAAkBH;AAEnB,yDAAA,zDAACI,iIAEA,WAAAC,SAAAC;AAAA,AAAA,IAAAC,aAAAF;IAAAE,iBAAA,AAAAC,4BAAAD;SAAA,AAAAE,4CAAAF,eAAA,hEAAaK;IAAbF,aAAAJ;QAAA,AAAAK,4CAAAD,WAAA,IAAA,/DAAmBG;WAAnB,AAAAF,4CAAAD,WAAA,IAAA,lEAAqBT;AAArB,AACE,IAAMa,IAAE,AAAA,2FAAWb;IACbc,WAAS,AAACC,sEAAgBF;IAC1BG,2BAAyB,AAAA,0HAA2BF;IACpDG,cAAY,CAACD,yDAAAA,+DAAAA,RAAyBhB,2CAAAA;AAH5C,AAIE,oBAAI,AAAA,mFAAOiB;AACT,uBAAA,mFAAA,1GAAChB,yLAAiCY,EAAEI;;AACpC,uBAAA,mFAAA,1GAAChB,oMAAuCY,EAAEI;;;AAN9C","names":["modular.oauth2.authorize.redirect-events/oauth-redirect-dispatch","data","re-frame.core/dispatch","modular.oauth2.authorize.redirect/register-callback","re_frame.core.reg_event_fx","p__41330","p__41331","map__41332","cljs.core/--destructure-map","cljs.core.get","vec__41333","cljs.core.nth","db","_","p","provider","modular.oauth2.protocol/provider-config","parse-authorize-response","auth-result"],"sourcesContent":["(ns modular.oauth2.authorize.redirect-events\n  (:require\n   [clojure.set :refer [rename-keys]]\n   [taoensso.timbre :refer-macros [info error]]\n   [re-frame.core :as rf]\n   [modular.oauth2.authorize.redirect :refer [register-callback]]\n   [modular.oauth2.token.save-handler] ; side effects\n   [modular.oauth2.protocol :refer [provider-config]]\n   [modular.oauth2.provider :refer [url-authorize]]))\n\n;; redirect\n\n(defn- oauth-redirect-dispatch [data]\n  (rf/dispatch [:oauth2/redirect data]))\n\n(register-callback oauth-redirect-dispatch)\n\n(rf/reg-event-fx\n :oauth2/redirect\n (fn [{:keys [db]} [_ data]]\n   (let [p (:provider data)\n         provider (provider-config p)\n         parse-authorize-response (:parse-authorize-response provider)\n         auth-result (parse-authorize-response data)]\n     (if (:code auth-result)\n       (rf/dispatch [:oauth2/code->token p auth-result])\n       (rf/dispatch [:oauth2/authorize-success p auth-result]))\n\n     nil)))\n\n\n"],"x_google_ignoreList":[0]}