{"version":3,"sources":["goldly/sci/loader/cljs_source_http.cljs"],"mappings":"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","names":["goldly.sci.loader.cljs-source-http/filename-to-url-goldly","filename","goldly.sci.loader.cljs-source-http/application-url","cemerick.url.url","js/window","goldly.sci.loader.cljs-source-http/filename-to-url-github","url","url-base","cljs.core.subs","clojure.string.last_index_of","taoensso.timbre._log_BANG_","taoensso.timbre/*config*","cljs.core/Delay","goldly.sci.loader.cljs-source-http/filename-to-url","goldly.sci.loader.cljs-source-http/set-github-load-mode","p__51787","map__51788","cljs.core/--destructure-map","cljs.core.get","goldly.sci.loader.cljs-source-http/load-module-sci","ctx","libname","ns","opts","property-path","d","goldly.sci.loader.cljs-source/ns->filename","js/Promise","resolve","reject","c__41247__auto__","cljs.core.async.chan","cljs.core.async.impl.dispatch/run","f__41248__auto__","switch__41224__auto__","state_51894","state_val_51896","inst_51822","statearr-51923","statearr-51925","statearr-51929","statearr-51934","inst_51836","inst_51837","inst_51838","cljs.core/PersistentHashMap","statearr-51948","inst_51841","inst_51852","statearr-51957","cljs.core.async.impl.ioc-helpers/take!","inst_51855","inst_51856","inst_51854","inst_51859","inst_51860","inst_51861","inst_51862","statearr-51962","statearr-51963","statearr-51964","inst_51868","cljs.core/PersistentVector","inst_51870","inst_51871","inst_51874","inst_51876","inst_51877","inst_51878","inst_51879","inst_51880","inst_51881","statearr-51965","inst_51883","inst_51884","statearr-51966","inst_51886","cljs.core.async.impl.ioc-helpers/return-chan","statearr-51967","state-machine__41225__auto__","ret-value__41226__auto__","result__41227__auto__","cljs.core/keyword-identical?","ex__41228__auto__","e51968","statearr-51969","cljs.core/seq","statearr-51970","cljs.core/first","state__41249__auto__","statearr-51971","cljs.core.async.impl.ioc-helpers/USER-START-IDX","cljs.core.async.impl.ioc-helpers/run-state-machine-wrapped","response","cljs_http.client.get","status","code","cljs.core._EQ_","goldly.sci.loader.cljs-source/on-cljs-received"],"sourcesContent":["(ns goldly.sci.loader.cljs-source-http\n  (:require\n   [taoensso.timbre :as timbre :refer-macros [debug debugf info warn error]]\n    [cljs.core.async :refer [<! >! chan close!] :refer-macros [go]]\n    [cljs-http.client :as http]\n    [clojure.string]\n    [cemerick.url :as curl]\n    [goldly.sci.loader.cljs-source :refer [ns->filename on-cljs-received]]))\n\n(defn filename-to-url-goldly [filename]\n  (str \"/code/\" filename))\n\n(defn application-url\n  \"gets the current url, as a map\"\n  []\n  (curl/url (-> js/window .-location .-href)))\n\n(defn filename-to-url-github [filename]\n  (let [url (application-url)\n        url-base (subs url (clojure.string/last-index-of url \"/\"))]\n    (info \"github url-base: \" url-base)\n    (str url-base filename)))\n\n(def filename-to-url\n   filename-to-url-goldly)                 \n\n(defn set-github-load-mode []\n  (def filename-to-url filename-to-url-github))\n\n\n(defn load-module-sci [{:keys [ctx libname ns opts property-path] :as d}]\n  ; libname: bongo.trott ; the ns that gets compiled\n  ; ns:  demo.notebook.applied-science-jsinterop ; the namespace that is using it\n  ; opts: {:as bongo, :refer [saying]}\n  ; ctx is the sci-context\n  (info \"load-sci-src\" \"libname:\" libname \"ns: \" ns \"opts:\" opts)\n  (let [filename (-> libname str ns->filename (str \".cljs\"))\n        url (filename-to-url filename)]\n    (info \"loading filename: \" filename)\n    (js/Promise.\n     (fn [resolve reject]\n       (go (let [opts (or opts {:with-credentials? false})\n                 response (<! (http/get url opts))\n                 status (:status response)\n                 code (:body response)]\n             (info \"load-module-sci-cljs url: \" url \"status: \" status)\n             (if (= status 200)\n               (on-cljs-received ctx libname ns opts resolve reject [:http-load {:result {:code code}}])\n               (reject (str \"failed to load: \" libname \" status: \" status \" url: \" url))\n               )))))))\n"]}